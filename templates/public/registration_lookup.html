{% extends "base.html" %}

{% block title %}Check Registration Status - Kickoff Arena{% endblock %}

{% block main_class %}pt-0{% endblock %}

{% block extra_head %}
<style>
    /* Enhanced gradient backgrounds */
    .hero-gradient {
        background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 25%, #99f6e4 50%, #5eead4 75%, #2dd4bf 100%);
        position: relative;
        overflow: hidden;
    }
    
    .hero-gradient::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.03'%3E%3Cpolygon fill='%23fff' points='50 0 60 40 100 50 60 60 50 100 40 60 0 50 40 40'/%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.1;
    }
    
    /* Feature card styling */
    .feature-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid rgba(16, 185, 129, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(20px);
    }
    
    .feature-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 25px 50px rgba(16, 185, 129, 0.15);
        border-color: rgba(16, 185, 129, 0.2);
    }
    
    /* Form styling */
    .form-input {
        background: #ffffff;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .form-input:focus {
        border-color: #10b981;
        box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        outline: none;
        transform: translateY(-1px);
    }
    
    /* Gradient text */
    .gradient-text {
        background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Enhanced buttons */
    .btn-primary {
        background: linear-gradient(135deg, #10b981, #34d399);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
    }
    
    /* Search result animations */
    .search-result {
        animation: slideInUp 0.5s ease-out;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 600;
    }
    
    .status-confirmed {
        background: linear-gradient(135deg, #10b981, #34d399);
        color: white;
    }
    
    .status-pending {
        background: linear-gradient(135deg, #f59e0b, #fbbf24);
        color: white;
    }
    
    .status-cancelled {
        background: linear-gradient(135deg, #ef4444, #f87171);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
    <!-- Modern Hero Section -->
    <div class="hero-gradient relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-green-500/10 to-teal-500/10"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Enhanced Breadcrumbs -->
            <nav class="flex mb-8 animate-fade-in" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-4">
                    <li>
                        <a href="{{ url_for('main.index') }}" class="text-green-600 hover:text-green-700 text-sm transition-colors">
                            <i class="fas fa-home"></i>
                            <span class="sr-only">Home</span>
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-300 text-sm mr-4"></i>
                            <span class="text-sm font-bold text-gray-900">Check Registration</span>
                        </div>
                    </li>
                </ol>
            </nav>
            
            <!-- Enhanced Title Section -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-xl border border-green-100 text-center">
                <div class="mb-8">
                    <div class="w-24 h-24 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                        <i class="fas fa-search text-white text-4xl"></i>
                    </div>
                    <h1 class="text-5xl font-black gradient-text mb-4">Check Registration</h1>
                    <p class="text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed">
                        Find your tournament registration status, view details, and manage your participation.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Search Form -->
        <div class="feature-card rounded-2xl shadow-xl overflow-hidden border border-blue-100 mb-8">
            <div class="px-8 py-6 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200">
                <div class="flex items-center mb-2">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mr-3 shadow-md">
                        <i class="fas fa-search text-white text-lg"></i>
                    </div>
                    <h2 class="text-2xl font-black text-gray-900">Find Your Registration</h2>
                </div>
                <p class="text-blue-700 ml-13">Enter your email address to search for your tournament registrations</p>
            </div>

            <div class="p-8">
                <form id="lookup-form" method="POST" class="space-y-6">
                    <div>
                        <label for="email" class="block text-sm font-bold text-gray-800 mb-3">
                            <i class="fas fa-envelope text-blue-500 mr-2"></i>
                            Email Address
                        </label>
                        <input type="email" 
                               id="email" 
                               name="email"
                               required
                               placeholder="Enter the email you used to register"
                               class="form-input w-full"
                               value="{{ request.form.get('email', '') }}">
                        <p class="text-sm text-gray-500 mt-2">We'll search all tournaments for registrations with this email address</p>
                    </div>

                    <div>
                        <label for="tournament_name" class="block text-sm font-bold text-gray-800 mb-3">
                            <i class="fas fa-trophy text-green-500 mr-2"></i>
                            Tournament Name (Optional)
                        </label>
                        <input type="text" 
                               id="tournament_name" 
                               name="tournament_name"
                               placeholder="Enter tournament name to narrow search"
                               class="form-input w-full"
                               value="{{ request.form.get('tournament_name', '') }}">
                        <p class="text-sm text-gray-500 mt-2">Leave blank to search all tournaments</p>
                    </div>

                    <div class="flex gap-4">
                        <button type="submit" 
                                class="btn-primary flex-1 text-white py-4 px-8 rounded-xl font-bold border border-transparent shadow-lg">
                            <i class="fas fa-search mr-2"></i>
                            Search Registrations
                        </button>
                        
                        <button type="button" 
                                onclick="clearForm()"
                                class="bg-gray-200 text-gray-700 py-4 px-8 rounded-xl font-bold hover:bg-gray-300 transition-colors">
                            <i class="fas fa-times mr-2"></i>
                            Clear
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Search Results -->
        {% if registrations is defined %}
        <div class="search-result">
            {% if registrations %}
                <div class="feature-card rounded-2xl shadow-xl overflow-hidden border border-green-100 mb-8">
                    <div class="px-8 py-6 bg-gradient-to-r from-green-50 to-green-100 border-b border-green-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mr-3 shadow-md">
                                    <i class="fas fa-check-circle text-white text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-black text-gray-900">{{ registrations|length }} Registration{{ 's' if registrations|length != 1 }} Found</h2>
                                    <p class="text-green-700">Found registrations for {{ request.form.get('email', '') }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="space-y-6">
                            {% for reg in registrations %}
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-green-300 transition-all">
                                <!-- Tournament Header -->
                                <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-100">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 {% if reg.tournament.type == 'solo' %}bg-gradient-to-br from-blue-500 to-blue-600{% else %}bg-gradient-to-br from-purple-500 to-purple-600{% endif %} rounded-xl flex items-center justify-center shadow-md">
                                            <i class="fas fa-{{ 'user' if reg.tournament.type == 'solo' else 'users' }} text-white text-lg"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900">{{ reg.tournament.name }}</h3>
                                            <p class="text-sm text-gray-600">{{ reg.tournament.type|title }} Tournament • {{ reg.tournament.format|replace('_', ' ')|title }}</p>
                                        </div>
                                    </div>
                                    
                                    <span class="status-badge status-confirmed">
                                        <i class="fas fa-check mr-2"></i>Confirmed
                                    </span>
                                </div>

                                <!-- Registration Details -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Registered Name</span>
                                        <p class="text-gray-900 font-medium">{{ reg.name }}</p>
                                    </div>
                                    
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Registration Date</span>
                                        <p class="text-gray-900">
                                            {% if reg.created_at %}
                                                {% if reg.created_at is string %}
                                                    {{ reg.created_at[:10] }}
                                                {% else %}
                                                    {{ reg.created_at.strftime('%B %d, %Y') }}
                                                {% endif %}
                                            {% else %}
                                                Recently
                                            {% endif %}
                                        </p>
                                    </div>
                                    
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Tournament Date</span>
                                        <p class="text-gray-900">
                                            {% if reg.tournament.start_date %}
                                                {% if reg.tournament.start_date is string %}
                                                    {{ reg.tournament.start_date[:10] }}
                                                {% else %}
                                                    {{ reg.tournament.start_date.strftime('%B %d, %Y') }}
                                                {% endif %}
                                            {% else %}
                                                TBD
                                            {% endif %}
                                        </p>
                                    </div>
                                    
                                    {% if reg.tournament.type == 'solo' and reg.skill_level %}
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Skill Level</span>
                                        <p class="text-gray-900 capitalize">{{ reg.skill_level }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if reg.phone %}
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Phone</span>
                                        <p class="text-gray-900">{{ reg.phone }}</p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if reg.tournament.type == 'team' and reg.short_name %}
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Team Tag</span>
                                        <p class="text-gray-900">{{ reg.short_name }}</p>
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Tournament Status -->
                                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <span class="text-sm font-medium text-gray-500">Tournament Status</span>
                                            <p class="text-gray-900 font-medium capitalize">
                                                {% if reg.tournament.status == 'registration_open' %}
                                                    <i class="fas fa-door-open text-green-500 mr-1"></i>Registration Open
                                                {% elif reg.tournament.status == 'in_progress' %}
                                                    <i class="fas fa-broadcast-tower text-blue-500 mr-1"></i>In Progress
                                                {% elif reg.tournament.status == 'completed' %}
                                                    <i class="fas fa-flag-checkered text-gray-500 mr-1"></i>Completed
                                                {% else %}
                                                    <i class="fas fa-clock text-orange-500 mr-1"></i>{{ reg.tournament.status|replace('_', ' ')|title }}
                                                {% endif %}
                                            </p>
                                        </div>
                                        
                                        {% if reg.tournament.entry_fee and reg.tournament.entry_fee > 0 %}
                                        <div class="text-right">
                                            <span class="text-sm font-medium text-gray-500">Entry Fee</span>
                                            <p class="text-gray-900 font-bold">${{ reg.tournament.entry_fee }}</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <a href="{{ url_for('main.tournament_details', tournament_id=reg.tournament.id) }}" 
                                       class="flex-1 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white py-3 px-6 rounded-lg font-medium transition-all text-center">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        View Tournament Details
                                    </a>
                                    
                                    {% if reg.tournament.status in ['registration_open', 'draft'] %}
                                    <button onclick="showCancelModal('{{ reg.tournament.name }}', '{{ reg.id }}')"
                                            class="bg-red-100 text-red-700 py-3 px-6 rounded-lg font-medium hover:bg-red-200 transition-colors">
                                        <i class="fas fa-times mr-2"></i>
                                        Cancel Registration
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="feature-card rounded-2xl shadow-xl overflow-hidden border border-orange-100">
                    <div class="p-12 text-center">
                        <div class="w-24 h-24 bg-gradient-to-br from-orange-100 to-orange-200 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-search text-orange-500 text-4xl"></i>
                        </div>
                        
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">No Registrations Found</h3>
                        <p class="text-gray-600 text-lg mb-8 max-w-2xl mx-auto leading-relaxed">
                            We couldn't find any tournament registrations for 
                            <strong>{{ request.form.get('email', '') }}</strong>
                            {% if request.form.get('tournament_name') %}
                            in tournaments matching "<strong>{{ request.form.get('tournament_name') }}</strong>"
                            {% endif %}.
                        </p>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                            <button onclick="clearForm()" 
                                    class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-bold transition-all">
                                <i class="fas fa-search mr-2"></i>Try Different Email
                            </button>
                            
                            <a href="{{ url_for('main.explore') }}" 
                               class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-8 py-4 rounded-xl font-bold transition-all">
                                <i class="fas fa-plus mr-2"></i>Register for Tournament
                            </a>
                        </div>
                        
                        <div class="mt-8 pt-8 border-t border-gray-200">
                            <p class="text-gray-500 text-sm mb-4">Tips for finding your registration:</p>
                            <div class="text-left text-sm text-gray-600 max-w-md mx-auto space-y-2">
                                <div>• Make sure you're using the exact email address from registration</div>
                                <div>• Check if you registered with a different email account</div>
                                <div>• Try leaving the tournament name field empty to search all tournaments</div>
                                <div>• Contact support if you're sure you registered but can't find it</div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Help Section -->
        {% if not (registrations is defined) %}
        <div class="feature-card rounded-2xl shadow-xl overflow-hidden border border-purple-100">
            <div class="px-8 py-6 bg-gradient-to-r from-purple-50 to-purple-100 border-b border-purple-200">
                <div class="flex items-center mb-2">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-md">
                        <i class="fas fa-question-circle text-white text-lg"></i>
                    </div>
                    <h2 class="text-2xl font-black text-gray-900">Need Help?</h2>
                </div>
                <p class="text-purple-700 ml-13">Common questions and helpful resources</p>
            </div>

            <div class="p-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4">What can I find?</h3>
                        <div class="space-y-3 text-sm text-gray-600">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check text-green-500 mt-0.5"></i>
                                <span>All tournament registrations linked to your email</span>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check text-green-500 mt-0.5"></i>
                                <span>Registration confirmation details</span>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check text-green-500 mt-0.5"></i>
                                <span>Tournament dates and status</span>
                            </div>
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-check text-green-500 mt-0.5"></i>
                                <span>Options to cancel if registration is still open</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Quick Links</h3>
                        <div class="space-y-3">
                            <a href="{{ url_for('main.registration_guide') }}" 
                               class="flex items-center text-purple-600 hover:text-purple-700 font-medium text-sm">
                                <i class="fas fa-book mr-2"></i>
                                How to Register Guide
                            </a>
                            <a href="{{ url_for('main.explore') }}" 
                               class="flex items-center text-purple-600 hover:text-purple-700 font-medium text-sm">
                                <i class="fas fa-search mr-2"></i>
                                Browse Tournaments
                            </a>
                            <a href="{{ url_for('main.contact') if url_for('main.contact') else '#' }}" 
                               class="flex items-center text-purple-600 hover:text-purple-700 font-medium text-sm">
                                <i class="fas fa-envelope mr-2"></i>
                                Contact Support
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
function clearForm() {
    document.getElementById('email').value = '';
    document.getElementById('tournament_name').value = '';
    document.getElementById('email').focus();
}

function showCancelModal(tournamentName, registrationId) {
    if (confirm(`Are you sure you want to cancel your registration for "${tournamentName}"? This action cannot be undone.`)) {
        // In a real implementation, this would send a cancellation request
        alert('Registration cancellation request submitted. You will receive a confirmation email shortly.');
    }
}

// Focus on email field when page loads
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('email').focus();
});
</script>
{% endblock %}
